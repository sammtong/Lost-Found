<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>물품 신고 폼</title>
    <link rel="stylesheet" href="../static/css/lost_found.css" />
</head>
<body>

<div class="form-container">
    <a class="back-button" href="javascript:window.history.back()">← 뒤로가기</a>
    <div class="form-title">잃어버린 물품에 대해 적어주세요</div>

    <div class="form-group">
        <label>물품 사진</label>
        <input type="file" id="fileInput" accept="image/*" />
    </div>

    <div class="form-group">
        <label>물품명</label>
        <input type="text" id="item_name" placeholder="예: 에어팟 프로 2" />
    </div>

    <div class="form-group">
        <label>날짜/시간</label>
        <input type="text" id="date" placeholder="예: 11/17, 19시경" />
    </div>

    <div class="form-group">
        <label>분실 장소</label>
        <input type="text" id="place" placeholder="예: 공학관 1층" />
    </div>

    <div class="form-group">
        <label>전화번호</label>
        <input type="text" id="phone" placeholder="-은 빼주세요" />
    </div>

    <div class="form-group">
        <label>세부 사항</label>
        <textarea id="content" placeholder="자세한 내용을 적어주세요."></textarea>
    </div>

    <button class="submit-btn" type="button" onclick="submitLost()">등록하기</button>
</div>

<script>
    async function submitLost() {
        const userId = localStorage.getItem('user_id');
        if (!userId) {
            alert('로그인이 필요한 서비스입니다.\n먼저 로그인 해주세요!');
            window.location.href = './login.html';
            return;
        }

        const item_name = document.getElementById('item_name').value;

        if(!item_name) {
            alert('물품명은 필수입니다.');
            return;
        }

        const formData = new FormData();
        formData.append('item_name', item_name);
        // [중요] 백엔드 필수값인 title을 item_name으로 대체
        formData.append('title', item_name); 
        formData.append('date', document.getElementById('date').value);
        formData.append('place', document.getElementById('place').value);
        formData.append('phone', document.getElementById('phone').value);
        formData.append('content', document.getElementById('content').value);
        formData.append('author', userId);

        const fileInput = document.getElementById('fileInput');
        if (fileInput.files[0]) {
            formData.append('image', fileInput.files[0]);
        }

        try {
            const res = await fetch('http://127.0.0.1:5000/api/lost', {
                method: 'POST',
                body: formData
            });

            if(res.ok) {
                alert('분실물이 등록되었습니다!');
            } else {
                alert('등록 실패');
            }
        } catch(e) {
            alert('서버 오류! app.py가 켜져있는지 확인해주세요.');
        }
    }
</script>

</body>
</html>