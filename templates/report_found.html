<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>물품 신고 폼</title>
    <link rel="stylesheet" href="../static/css/lost_found.css" />
</head>
<body>

<div class="form-container">
    <a class="back-button" href="javascript:window.history.back()">← 뒤로가기</a>

    <div class="form-title">습득한 물건에 대해 적어주세요</div>

    <div class="form-group">
        <label>물품 사진</label>
        <input type="file" id="fileInput" class="real-file" accept="image/*" />
    </div>

    <div class="form-group">
        <label>물품명 </label>
        <input type="text" id="item_name" placeholder="예: 에어팟 프로 2" />
    </div>

        <div class="form-group">
        <label>날짜/시간 </label>
        <input type="text" id="item_name" placeholder="예: 11/17, 19시경" />
    </div>

    <div class="form-group">
        <label>습득 장소</label>
        <input type="text" id="place" placeholder="예: 학생회관 식당" />
    </div>
        <div class="form-group">
        <label>전화번호</label>
        <input type="text" id="place" placeholder="-은 빼주세요" />
    </div>

    <div class="form-group">
        <label>세부 사항</label>
        <textarea id="content" placeholder="자세한 내용을 적어주세요."></textarea>
    </div>

    <button class="submit-btn" onclick="submitFound()">등록하기</button>
</div>

<script>
    async function submitFound() {
        // 1. 로그인 체크
        const userId = localStorage.getItem('user_id');
        if (!userId) {
            alert('로그인이 필요한 서비스입니다.\n먼저 로그인 해주세요!');
            window.location.href = './login.html';
            return;
        }

        // 2. 데이터 수집
        // [수정됨] place 값을 입력창에서 가져오도록 변경 (입력 없으면 '장소 미상')
        const placeInput = document.getElementById('place').value;
        
        const data = {
            item_name: document.getElementById('item_name').value,
            title: document.getElementById('title').value,
            content: document.getElementById('content').value,
            place: placeInput ? placeInput : "장소 미상" 
        };

        // 3. 필수값 확인
        if(!data.title || !data.item_name) {
            alert('물품명과 제목은 필수입니다.');
            return;
        }

        // 4. 서버 전송
        try {
            const res = await fetch('http://127.0.0.1:5000/api/found', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });

            if(res.ok) {
                alert('습득물이 등록되었습니다!');
                window.location.href = './index.html';
            } else {
                alert('등록 실패');
            }
        } catch(e) {
            alert('서버 오류! app.py가 켜져있는지 확인해주세요.');
        }
    }
</script>

</body>
</html>