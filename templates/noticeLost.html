<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>분실물 상세보기</title>
  <link rel="stylesheet" href="../static/css/Notice_LostFound.css">
</head>
<body>

<!-- 이미지 확대 모달 -->
<div id="imgModal" class="img-modal">
  <span class="img-modal-close">&times;</span>
  <img class="img-modal-content" id="modalImg">
</div>

  <div class="container">
    <h1 id="title">물품명 불러오는 중...</h1>
    <div class="meta">작성자: <span id="author">-</span></div>

    <div class="photo" id="photo">사진 없음</div>

    <div class="notice_wrapper">
      <div class="left_box">
        <div class="info-box">
          <div class="info-title">물품명</div>
          <div class="info-text" id="item">-</div>
        </div>
        <div class="info-box">
          <div class="info-title">날짜/시간</div>
          <div class="info-text" id="date">-</div>
        </div>
        <div class="info-box">
          <div class="info-title">분실 장소</div>
          <div class="info-text" id="place">-</div>
        </div>
      </div>

      <div class="right_box">
        <div class="info-box">
          <div class="info-title">전화번호</div>
          <div class="info-text" id="phone">-</div>
        </div>
        <div class="info-box">
          <div class="info-title">세부 사항</div>
          <div class="info-text" id="content">-</div>
        </div>
      </div>
    </div>

    <a href="./index.html" class="back">← 목록으로 돌아가기</a>
  </div>

<script>
async function loadDetail() {
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');

    if (!id) {
        alert("잘못된 접근입니다.");
        window.location.href = './index.html';
        return;
    }

    try {
        const res = await fetch(`http://127.0.0.1:5000/api/lost/${id}`);

        if (res.ok) {
            const data = await res.json();

            document.getElementById('title').innerText = data.title;
            document.getElementById('author').innerText = data.author || '익명';
            document.getElementById('item').innerText = data.item_name;
            document.getElementById('date').innerText = data.date || '-';
            document.getElementById('place').innerText = data.place;
            document.getElementById('phone').innerText = data.phone || '비공개';
            document.getElementById('content').innerText = data.content;

            if (data.image) {
                document.getElementById('photo').innerHTML =
                    `<img id="detailImg" src="../static/uploads/${data.image}"
                      style="max-width:100%; border-radius:8px; cursor:pointer;">`;
                setupImageModal();
            }
        } else {
            alert("삭제되었거나 없는 게시글입니다.");
            window.location.href = './index.html';
        }
    } catch (error) {
        alert("서버 연결 실패");
    }
}

function setupImageModal() {
    const modal = document.getElementById("imgModal");
    const modalImg = document.getElementById("modalImg");
    const closeBtn = document.querySelector(".img-modal-close");
    const detailImg = document.getElementById("detailImg");

    if (!detailImg) return;

    detailImg.onclick = () => {
        modal.style.display = "block";
        modalImg.src = detailImg.src;
    };

    closeBtn.onclick = () => {
        modal.style.display = "none";
    };

    modal.onclick = (e) => {
        if (e.target === modal) modal.style.display = "none";
    };
}

window.onload = loadDetail;
</script>

</body>
</html>
