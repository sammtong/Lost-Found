<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì–´ë””ìˆì°Œ LOST & FOUND - 1ëŒ€1 ë¬¸ì˜</title>
    <link rel="stylesheet" href="../static/css/style.css">
</head>
<body>
    <div class="content">
        <div id="query-page" class="page service-page">
            <header class="form-header">
                <img class="logo" src="../static/images/logo.png" alt="ì–´ë””ìˆì°Œ LOST & FOUND ë¡œê³ ">
                <a class="back-button" href="./index.html">ë’¤ë¡œê°€ê¸°</a>
            </header>
            <div class="line"></div>
            <div class="content-area">
                <div class="form-container wide query-form-container">
                    <h2>1ëŒ€1 ë¬¸ì˜ ì‘ì„± ğŸ’¬</h2>
                    <form onsubmit="return false;" class="query-form">
                        <div class="form-group">
                            <label for="query_title">ì œëª©</label>
                            <input type="text" id="query_title" name="query_title" placeholder="ë¬¸ì˜ ì œëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”." required>
                        </div>
                        <div class="form-group">
                            <label for="query_email">ë‹µë³€ ë°›ì„ ì´ë©”ì¼</label>
                            <input type="email" id="query_email" name="query_email" placeholder="ë‹µë³€ì„ ë°›ì„ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”." required>
                        </div>
                        <div class="form-group">
                            <label for="query_content">ë¬¸ì˜ ë‚´ìš©</label>
                            <textarea id="query_content" name="query_content" rows="10" placeholder="ìƒì„¸í•œ ë¬¸ì˜ ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”." required></textarea>
                        </div>
                        <button type="submit" class="submit-button" onclick="sendQuery()">ë¬¸ì˜ ì œì¶œí•˜ê¸°</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function sendQuery() {
            // 1. [ì¶”ê°€ë¨] ë¡œê·¸ì¸ ì²´í¬ (ìˆ˜ë¬¸ì¥)
            const userId = localStorage.getItem('user_id');
            if (!userId) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.\në¨¼ì € ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”!');
                window.location.href = './login.html'; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                return;
            }

            // 2. ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
            const title = document.getElementById('query_title').value;
            const email = document.getElementById('query_email').value;
            const content = document.getElementById('query_content').value;

            // 3. í•„ìˆ˜ ì…ë ¥ í™•ì¸
            if(!title || !content || !email) {
                alert("ëª¨ë“  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            // 4. ì„œë²„ ì „ì†¡
            try {
                const res = await fetch('http://127.0.0.1:5000/api/query', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ title, email, content })
                });

                if (res.ok) {
                    alert('ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    window.location.href = './index.html';
                } else {
                    alert('ì „ì†¡ ì‹¤íŒ¨');
                }
            } catch (e) {
                alert('ì„œë²„ ì—°ê²° ì‹¤íŒ¨!');
            }
        }
    </script>
</body>
</html>