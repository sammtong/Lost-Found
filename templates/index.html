<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>어디있찌 LOST & FOUND</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <div class="content">

        <div id="main-page" class="page">
            <header>
                <img class="logo" src="./images/logo.png" alt="어디있찌 LOST & FOUND 로고">
                <ul class="flex" id="auth-menu">
                    <li><a href="./login.html">로그인</a></li>
                    <li><a href="./register.html">회원가입</a></li>
                </ul>
            </header>
            <div class="line"></div>

            <div class="service-boxes flex">
                <a href="./report_lost.html" class="service-item lost">
                    <h3>🙏 찾고 싶어요</h3>
                </a>
                <a href="./report_found.html" class="service-item register">
                    <h3>😇 찾아 줄게요</h3>
                </a>
                <a href="./query.html" class="service-item query">
                    <h3>💬 1대1 문의</h3>
                </a>
                <a href="./help.html" class="service-item help">
                    <h3>❓ 도움말</h3>
                </a>
            </div>
            
            <div class="two_items_container">
                <div class="two_items flex">
                    <div class="find">
                        <p>주인을 찾아요! (습득물) </p>
                        <ul>
                            <li>불러오는 중...</li> 
                        </ul>
                    </div>
                    <div class="found">
                        <p>잃어버렸어요! (분실물)</p>
                        <ul>
                            <li>불러오는 중...</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 1. 로그인 상태 확인 및 상단 메뉴 변경 함수
        function checkLogin() {
            const userId = localStorage.getItem('user_id'); // 저장된 아이디 가져오기
            const menu = document.getElementById('auth-menu'); // 메뉴 위치 가져오기

            if (userId) {
                // 로그인이 되어 있다면 -> 아이디와 로그아웃 버튼 표시
                menu.innerHTML = `
                    <li style="margin-right: 20px; font-weight: bold; color: #2d6bba;">${userId}님 환영합니다!</li>
                    <li><a href="#" onclick="logout()">로그아웃</a></li>
                `;
            } else {
                // 로그인이 안 되어 있다면 -> 로그인/회원가입 버튼 표시
                menu.innerHTML = `
                    <li><a href="./login.html">로그인</a></li>
                    <li><a href="./register.html">회원가입</a></li>
                `;
            }
        }

        // 2. 로그아웃 함수
        function logout() {
            localStorage.removeItem('user_id'); // 저장된 아이디 삭제
            alert('로그아웃 되었습니다.');
            location.reload(); // 새로고침
        }

        // 3. 게시글 데이터 불러오기 함수
        async function loadItems() {
            try {
                // 습득물 가져오기
                const foundRes = await fetch('http://127.0.0.1:5000/api/found');
                if (foundRes.ok) {
                    const foundData = await foundRes.json();
                    const findList = document.querySelector('.find ul');
                    if (foundData.length > 0) {
                        findList.innerHTML = foundData.map(item => `<li><a href="#">${item.title || '제목 없음'}</a></li>`).join('');
                    } else {
                        findList.innerHTML = '<li>등록된 습득물이 없습니다.</li>';
                    }
                }

                // 분실물 가져오기
                const lostRes = await fetch('http://127.0.0.1:5000/api/lost');
                if (lostRes.ok) {
                    const lostData = await lostRes.json();
                    const lostList = document.querySelector('.found ul'); 
                    if (lostData.length > 0) {
                        lostList.innerHTML = lostData.map(item => `<li><a href="#">${item.title || '제목 없음'}</a></li>`).join('');
                    } else {
                        lostList.innerHTML = '<li>등록된 분실물이 없습니다.</li>';
                    }
                }

            } catch (error) {
                console.error("데이터 불러오기 실패 (LOST.py 확인 필요):", error);
            }
        }

        // 페이지가 열리면 실행
        window.onload = function() {
            checkLogin(); // 로그인 체크 먼저 하고
            loadItems();  // 데이터 불러오기
        };
    </script>
</body>
</html>